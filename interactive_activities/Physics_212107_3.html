<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  html,body{height:100%;margin:0;background:#fcfbf9;font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;}
  .stage{width:min(100vmin,100vmin);height:min(100vmin,100vmin);display:block;margin:auto;}
  #startStopButton{cursor:pointer}
  #startStopButton:active {opacity:.9}
  #bobGroup{cursor:grab}
  #bobGroup.dragging{cursor:grabbing}
  #bobCircle{transition: transform 120ms ease}
  @keyframes bobBounce {
    0% { transform: scale(1)}
    50%{ transform: scale(1.1)}
    100%{ transform: scale(1)}
  }
  .bounce #bobCircle{ animation: bobBounce 250ms ease-out }
  text{user-select:none}
  .timerText{font-weight:700;fill:#1f2326}
  .timerS{fill:#808285}
  .btnText{font-weight:800;fill:#ffffff;letter-spacing:2px}
  .shadow{filter:url(#shadow)}
  #timerCard{fill:#ffffff}
</style>
</head>
<body>
<svg id="svg" class="stage" viewBox="0 0 1024 1024">
  <defs>
    <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
      <feDropShadow dx="0" dy="6" stdDeviation="12" flood-color="#dcdcdc" flood-opacity=".6"/>
    </filter>
    <linearGradient id="btnGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0" stop-color="#56c147"/>
      <stop offset="1" stop-color="#41b338"/>
    </linearGradient>
    <linearGradient id="btnGradStop" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0" stop-color="#f05a4b"/>
      <stop offset="1" stop-color="#e24237"/>
    </linearGradient>
  </defs>

  <!-- Pendulum -->
  <g id="pendulum">
    <line id="arm" x1="512" y1="120" x2="512" y2="740" stroke="#2f3337" stroke-width="18" stroke-linecap="round"/>
    <g id="bobGroup" transform="translate(512,740)">
      <circle id="bobCircle" r="78" fill="#5eb4d3"/>
    </g>
  </g>

  <!-- Curved arrow under bob -->
  <g opacity=".75" pointer-events="none">
    <path d="M360 800 C 470 875, 610 865, 682 820" fill="none" stroke="#8b8c8e" stroke-width="18" stroke-linecap="round"/>
    <path d="M665 786 L 720 806 L 678 845 Z" fill="#8b8c8e"/>
  </g>

  <!-- Timer Display -->
  <g id="timerDisplay" class="shadow">
    <rect id="timerCard" x="84" y="804" rx="40" ry="40" width="360" height="150"/>
    <text id="timerMain" class="timerText" x="150" y="900" font-size="90">0.00</text>
    <text class="timerS" x="355" y="905" font-size="64">s</text>
  </g>

  <!-- Start/Stop Button -->
  <g id="startStopButton" class="shadow">
    <rect id="btnRect" x="580" y="804" rx="48" ry="48" width="360" height="150" fill="url(#btnGrad)"/>
    <text id="btnLabel" class="btnText" x="760" y="900" font-size="84" text-anchor="middle">START</text>
  </g>
</svg>

<script>
  const svg = document.getElementById('svg');
  const arm = document.getElementById('arm');
  const bobGroup = document.getElementById('bobGroup');
  const bobCircle = document.getElementById('bobCircle');
  const startStopButton = document.getElementById('startStopButton');
  const btnRect = document.getElementById('btnRect');
  const btnLabel = document.getElementById('btnLabel');
  const timerMain = document.getElementById('timerMain');

  const vb = svg.viewBox.baseVal;
  const pivot = { x: 512, y: 120 };
  let L = 620; // pendulum length in SVG units
  let theta = 0; // angle from vertical (radians)
  let omega = 0; // angular velocity
  let isRunning = false;
  let dragging = false;
  let lastTime = null;
  let elapsed = 0;

  function setBobFromAngle() {
    const x = pivot.x + L * Math.sin(theta);
    const y = pivot.y + L * Math.cos(theta);
    arm.setAttribute('x2', x);
    arm.setAttribute('y2', y);
    bobGroup.setAttribute('transform', `translate(${x},${y})`);
  }

  function setBobFromX(x) {
    const dx = Math.max(-L + 1, Math.min(L - 1, x - pivot.x));
    const y = pivot.y + Math.sqrt(L*L - dx*dx);
    const nx = pivot.x + dx;
    arm.setAttribute('x2', nx);
    arm.setAttribute('y2', y);
    bobGroup.setAttribute('transform', `translate(${nx},${y})`);
    theta = Math.asin(dx / L);
  }

  function svgPoint(evt){
    const pt = svg.createSVGPoint();
    pt.x = evt.clientX; pt.y = evt.clientY;
    const m = svg.getScreenCTM().inverse();
    return pt.matrixTransform(m);
  }

  function start() {
    if (isRunning) return;
    isRunning = true;
    lastTime = performance.now();
    btnRect.setAttribute('fill', 'url(#btnGradStop)');
    btnLabel.textContent = 'STOP';
    requestAnimationFrame(tick);
  }

  function stopReset() {
    isRunning = false;
    elapsed = 0;
    timerMain.textContent = '0.00';
    theta = 0; omega = 0;
    setBobFromAngle();
    btnRect.setAttribute('fill', 'url(#btnGrad)');
    btnLabel.textContent = 'START';
  }

  function tick(t) {
    if (!isRunning) return;
    const dt = Math.min(0.032, (t - lastTime) / 1000);
    lastTime = t;

    const g = 9.81 * (1024 / 1024); // gravity, consistent scale
    const alpha = -(g / L) * Math.sin(theta);
    omega += alpha * dt;
    omega *= 0.999; // small damping
    theta += omega * dt;

    elapsed += dt;
    timerMain.textContent = elapsed.toFixed(2);

    setBobFromAngle();
    requestAnimationFrame(tick);
  }

  function onPointerDown(e){
    dragging = true;
    bobGroup.classList.add('dragging');
    svg.setPointerCapture(e.pointerId);
    isRunning = false; // pause while adjusting
    btnRect.setAttribute('fill', 'url(#btnGrad)');
    btnLabel.textContent = 'START';
  }
  function onPointerMove(e){
    if(!dragging) return;
    const p = svgPoint(e);
    let x = p.x;
    x = Math.max(40, Math.min(vb.width-40, x));
    setBobFromX(x);
  }
  function onPointerUp(e){
    if(!dragging) return;
    dragging = false;
    bobGroup.classList.remove('dragging');
    bobGroup.classList.add('bounce');
    setTimeout(()=>bobGroup.classList.remove('bounce'),260);
    omega = 0;
    start();
  }

  bobGroup.addEventListener('pointerdown', onPointerDown);
  svg.addEventListener('pointermove', onPointerMove);
  svg.addEventListener('pointerup', onPointerUp);
  svg.addEventListener('pointercancel', onPointerUp);
  svg.addEventListener('pointerleave', onPointerUp);

  startStopButton.addEventListener('click', ()=> {
    if (isRunning) stopReset(); else start();
  });

  setBobFromAngle();
</script>
</body>
</html>