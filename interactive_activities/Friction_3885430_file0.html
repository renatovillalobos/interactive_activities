<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Friction Simulation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #fefcf9;
      overflow: hidden;
      font-family: sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    #simulator {
      text-align: center;
    }
    svg {
      max-width: 100vw;
      height: auto;
    }
    #startButton {
      background-color: #4caf50;
      color: white;
      border: none;
      padding: 12px 28px;
      font-size: 18px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 16px;
      transition: background-color 0.3s ease;
    }
    #startButton:disabled {
      background-color: #a5d6a7;
      cursor: default;
    }
  </style>
</head>
<body>
  <div id="simulator">
    <svg id="canvas" viewBox="0 0 800 400" preserveAspectRatio="xMidYMid meet">
      <defs>
        <filter id="shadow">
          <feDropShadow dx="0" dy="2" stdDeviation="2" flood-color="rgba(0,0,0,0.2)" />
        </filter>
      </defs>

      <g id="background">
        <rect x="0" y="0" width="800" height="400" fill="#fefcf9"/>
      </g>

      <g id="surface">
        <rect x="0" y="150" width="800" height="110" rx="10" fill="#e5e3e0" />
      </g>

      <g id="lane1">
        <rect x="0" y="150" width="400" height="50" fill="#d3a87c"/>
        <rect x="400" y="150" width="400" height="50" fill="#d8d5d1"/>
      </g>

      <g id="lane2">
        <rect x="0" y="210" width="800" height="50" fill="#d8d5d1"/>
      </g>

      <g id="car1" class="car" cursor="pointer">
        <circle cx="40" cy="175" r="20" fill="#ff4c4c" filter="url(#shadow)"/>
      </g>

      <g id="car2" class="car" cursor="pointer">
        <circle cx="40" cy="235" r="20" fill="#4c8cff" filter="url(#shadow)"/>
      </g>
    </svg>
    <button id="startButton">Start</button>
  </div>

  <script>
    const svg = document.getElementById('canvas');
    const car1 = document.getElementById('car1').querySelector('circle');
    const car2 = document.getElementById('car2').querySelector('circle');
    const startButton = document.getElementById('startButton');

    let isDragging = false;
    let dragTarget = null;
    let offsetX = 0;
    let simulating = false;
    let rafId = null;

    const initialPos1 = 40;
    const initialPos2 = 40;
    let pos1 = initialPos1;
    let pos2 = initialPos2;
    let vel1 = 0;
    let vel2 = 0;
    let finished1 = false;
    let finished2 = false;

    const frictionLeft = 0.05;
    const frictionRight = 0.01;
    const acceleration = 0.1;

    const minX = 40;
    const maxX = 760;

    function setCarX(car, x) {
      car.setAttribute('cx', x);
    }

    function pointerDown(e) {
      if (simulating) return;
      const pt = getSVGPoint(e);
      const target = e.currentTarget.querySelector('circle');
      if (target) {
        isDragging = true;
        dragTarget = target;
        offsetX = pt.x - parseFloat(target.getAttribute('cx'));
        svg.setPointerCapture(e.pointerId);
      }
    }

    function pointerMove(e) {
      if (!isDragging || !dragTarget || simulating) return;
      const pt = getSVGPoint(e);
      let newX = pt.x - offsetX;
      newX = Math.max(minX, Math.min(newX, maxX));
      const cy = parseFloat(dragTarget.getAttribute('cy'));

      dragTarget.setAttribute('cx', newX);

      if (cy === 175) pos1 = newX;
      else if (cy === 235) pos2 = newX;

      checkResetState();
    }

    function pointerUp(e) {
      if (isDragging) {
        isDragging = false;
        dragTarget = null;
        svg.releasePointerCapture(e.pointerId);
      }
    }

    function getSVGPoint(evt) {
      const point = svg.createSVGPoint();
      if (evt.touches) {
        point.x = evt.touches[0].clientX;
        point.y = evt.touches[0].clientY;
      } else {
        point.x = evt.clientX;
        point.y = evt.clientY;
      }
      return point.matrixTransform(svg.getScreenCTM().inverse());
    }

    function checkResetState() {
      if (Math.abs(pos1 - initialPos1) < 1 && Math.abs(pos2 - initialPos2) < 1) {
        startButton.disabled = false;
      } else {
        startButton.disabled = true;
      }
    }

    function simulate() {
      if (finished1 && finished2) {
        simulating = false;
        cancelAnimationFrame(rafId);
        return;
      }

      if (!finished1) {
        vel1 += acceleration;
        vel1 -= frictionLeft * vel1;
        pos1 += vel1;
        if (pos1 >= maxX) {
          pos1 = maxX;
          finished1 = true;
        }
        setCarX(car1, pos1);
      }

      if (!finished2) {
        vel2 += acceleration;
        vel2 -= frictionRight * vel2;
        pos2 += vel2;
        if (pos2 >= maxX) {
          pos2 = maxX;
          finished2 = true;
        }
        setCarX(car2, pos2);
      }

      rafId = requestAnimationFrame(simulate);
    }

    function startSimulation() {
      if (simulating) return;

      simulating = true;
      startButton.disabled = true;
      vel1 = 0;
      vel2 = 0;
      finished1 = false;
      finished2 = false;
      simulate();
    }

    document.getElementById('car1').addEventListener('pointerdown', pointerDown);
    document.getElementById('car2').addEventListener('pointerdown', pointerDown);
    svg.addEventListener('pointermove', pointerMove);
    svg.addEventListener('pointerup', pointerUp);
    svg.addEventListener('pointerleave', pointerUp);

    startButton.addEventListener('click', startSimulation);
    checkResetState();
  </script>
</body>
</html>