<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Spring Mass Simulator</title>
<style>
  html,body{height:100%;margin:0;background:#f7f4ef;}
  svg{width:100%;height:100%;display:block;-webkit-tap-highlight-color:transparent;user-select:none}
  .noselect{user-select:none}
  .btn{cursor:pointer;transition:transform .12s ease}
  .btn:active{transform:scale(.98)}
  .draggable{cursor:grab;transition:filter .15s ease, transform .12s ease}
  .draggable:active{cursor:grabbing}
  .draggable:hover{filter:url(#hoverShadow)}
  #sliderKnob{cursor:grab;transition:filter .15s ease}
  #sliderKnob:hover{filter:url(#glow)}
  #resetBtn{cursor:pointer}
  .text{font-family: Arial, Helvetica, sans-serif; fill:#222; font-weight:600; letter-spacing:.2px}
  .sub{font-size:28px; opacity:.9}
  .label{font-size:30px}
</style>
</head>
<body>
<svg viewBox="0 0 1200 900" id="svgRoot">
  <defs>
    <filter id="cardShadow" x="-40%" y="-40%" width="180%" height="180%">
      <feDropShadow dx="0" dy="8" stdDeviation="18" flood-color="#000" flood-opacity=".08"/>
    </filter>
    <filter id="softShadow" x="-50%" y="-50%" width="200%" height="200%">
      <feDropShadow dx="0" dy="8" stdDeviation="8" flood-color="#487aa0" flood-opacity=".25"/>
    </filter>
    <filter id="hoverShadow" x="-50%" y="-50%" width="200%" height="200%">
      <feDropShadow dx="0" dy="10" stdDeviation="10" flood-color="#487aa0" flood-opacity=".35"/>
    </filter>
    <filter id="glow" x="-70%" y="-70%" width="240%" height="240%">
      <feDropShadow dx="0" dy="0" stdDeviation="10" flood-color="#7bbcf2" flood-opacity=".8"/>
    </filter>
    <linearGradient id="sliderTrackGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#e9e7e4"/>
      <stop id="sliderGradStop" offset="50%" stop-color="#b7d9f3"/>
      <stop offset="100%" stop-color="#e9e7e4"/>
    </linearGradient>
    <pattern id="dotPattern" width="16" height="20" patternUnits="userSpaceOnUse">
      <circle cx="8" cy="10" r="3" fill="#7fc0ea"/>
    </pattern>
  </defs>

  <!-- Big card -->
  <g id="card" filter="url(#cardShadow)">
    <rect x="80" y="60" width="1040" height="720" rx="40" fill="#fff"/>
  </g>

  <!-- Left mass rack background -->
  <g id="leftRack">
    <rect x="160" y="198" width="190" height="308" rx="26" fill="#f2f1ef"/>
  </g>

  <!-- Mass options (draggables) -->
  <g id="massOptions">
    <g id="mass1" class="draggable" data-mass="1" transform="translate(190,236)">
      <rect width="130" height="62" rx="16" fill="#b7d9f3"/>
      <rect width="130" height="62" rx="16" fill="transparent"/>
    </g>
    <g id="mass2" class="draggable" data-mass="2" transform="translate(190,316)">
      <rect width="130" height="62" rx="16" fill="#b7d9f3"/>
      <rect width="130" height="62" rx="16" fill="transparent"/>
    </g>
    <g id="mass3" class="draggable" data-mass="3" transform="translate(190,396)">
      <rect width="130" height="62" rx="16" fill="#b7d9f3"/>
      <rect width="130" height="62" rx="16" fill="transparent"/>
    </g>
  </g>

  <!-- Right slider and reset -->
  <g id="rightControls">
    <!-- track background slot -->
    <rect x="972" y="160" width="52" height="452" rx="26" fill="#efefef"/>
    <rect x="986" y="176" width="24" height="420" rx="12" fill="url(#sliderTrackGrad)" id="sliderTrack"/>
    <!-- fill progress (from bottom up) -->
    <rect x="986" y="176" width="24" height="420" rx="12" fill="#b7d9f3" opacity=".65" id="sliderFill" clip-path="url(#clipFill)"/>
    <clipPath id="clipFill">
      <rect x="986" y="176" width="24" height="420" rx="12"/>
    </clipPath>
    <!-- knob -->
    <g id="slider" class="btn">
      <g id="sliderKnob" transform="translate(998,368)" filter="">
        <circle r="28" fill="#8ec7ee"/>
      </g>
    </g>
    <!-- reset button -->
    <g id="resetBtn" class="btn" transform="translate(940,618)" filter="url(#softShadow)">
      <rect width="130" height="60" rx="30" fill="#8ec7ee"/>
    </g>
  </g>

  <!-- Center spring system -->
  <g id="system">
    <!-- Curved arrow hint -->
    <g id="oscArrow" transform="translate(480,420) rotate(180)">
      <path d="M0 0 A60 60 0 0 1 60 -60" fill="none" stroke="#8ec7ee" stroke-width="8" stroke-linecap="round"/>
      <path d="M62 -74 L84 -52 L55 -46 Z" fill="#8ec7ee"/>
    </g>

    <!-- Spring anchor and coil -->
    <g id="springGroup" transform="translate(620,120)">
      <path d="M0 0 L0 16" stroke="#111" stroke-width="10" stroke-linecap="round"/>
      <g id="coil" transform="translate(0,16)">
        <path id="springPath" d="" stroke="#111" stroke-width="10" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </g>
    </g>

    <!-- Hanging mass -->
    <g id="attachedMass" transform="translate(560,420)" filter="url(#softShadow)">
      <rect id="massRect" width="120" height="120" rx="24" fill="#8ec7ee"/>
    </g>

    <!-- Dotted stretch indicator below mass -->
    <g id="stretchDotted" transform="translate(620,540)">
      <rect x="-4" y="0" width="8" height="140" fill="url(#dotPattern)" opacity=".9"/>
    </g>
  </g>

  <!-- Bottom cards -->
  <g id="bottomCards">
    <g transform="translate(120,760)" filter="url(#cardShadow)">
      <rect width="280" height="110" rx="26" fill="#fff"/>
      <rect x="40" y="26" width="62" height="62" rx="16" fill="#8ec7ee"/>
      <text class="text label" x="120" y="70">Mass</text>
    </g>
    <g transform="translate(420,760)" filter="url(#cardShadow)">
      <rect width="280" height="110" rx="26" fill="#fff"/>
      <path d="M70 36 l10 0 l-18 24 l26 0 l-18 24 l26 0" stroke="#75b8e9" stroke-width="10" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      <text class="text label" x="120" y="70">Spring contant</text>
    </g>
    <g transform="translate(720,760)" filter="url(#cardShadow)">
      <rect width="280" height="110" rx="26" fill="#fff"/>
      <g transform="translate(70,30)">
        <rect x="-4" y="0" width="8" height="66" fill="url(#dotPattern)" opacity=".9"/>
      </g>
      <text class="text label" x="120" y="70">Stretch length</text>
    </g>
  </g>

  <!-- Invisible hit area at spring bottom for snapping -->
  <g id="snapZone" opacity="0">
    <circle id="attachPoint" cx="620" cy="480" r="70" fill="red" opacity="0"/>
  </g>

  <!-- Accessibility hidden titles -->
  <title>Spring Mass Simulator</title>
</svg>

<script>
(function(){
  const svg = document.getElementById('svgRoot');

  const springTop = {x:620,y:120};
  const L0 = 340; // base coil length in px
  const coilTurns = 9;
  const amp = 28;

  const kMin = 20, kMax = 200, kStep = 10;
  const trackTop = 176, trackHeight = 420;
  const knob = document.getElementById('sliderKnob');
  const sliderFill = document.getElementById('sliderFill');
  const sliderGradStop = document.getElementById('sliderGradStop');

  const springGroup = document.getElementById('springGroup');
  const coil = document.getElementById('coil');
  const springPath = document.getElementById('springPath');
  const massGroup = document.getElementById('attachedMass');
  const massRect = document.getElementById('massRect');
  const dotted = document.getElementById('stretchDotted');
  const attachPoint = document.getElementById('attachPoint');

  const resetBtn = document.getElementById('resetBtn');

  const options = Array.from(document.querySelectorAll('#massOptions .draggable'));

  // Generate spring path
  function buildSpringPath(turns, height, amplitude){
    let d = "M0 0";
    const step = height/turns;
    let dir = 1;
    let y=0;
    for(let i=0;i<turns;i++){
      y += step/2;
      d += ` L ${amplitude*dir} ${y}`;
      dir *= -1;
      y += step/2;
      d += ` L ${amplitude*dir} ${y}`;
    }
    d += ` L 0 ${height}`;
    springPath.setAttribute('d', d);
  }
  buildSpringPath(coilTurns, L0, amp);

  // Simulation state
  let currentMass = 1;
  let springK = 120; // default roughly mid
  let currentExt = 0; // current extension px
  const g = 9.81;
  const pxFactor = 6000; // tuning factor for visible extension

  // Position helpers
  function setKnobFromK(k){
    const t = (k - kMin) / (kMax - kMin);
    const y = trackTop + (1 - t) * trackHeight;
    knob.setAttribute('transform', `translate(998,${y})`);
    // fill gradient and progress
    const fillY = trackTop + trackHeight - (y - trackTop);
    sliderFill.setAttribute('y', y);
    sliderFill.setAttribute('height', trackTop + trackHeight - y);
    sliderGradStop.setAttribute('offset', `${t*100}%`);
  }
  setKnobFromK(springK);

  function setSystem(ext){
    currentExt = ext;
    const scale = (L0 + ext) / L0;
    coil.setAttribute('transform', `translate(0,16) scale(1,${scale})`);
    // mass position
    const massX = springTop.x - 60;
    const massY = springTop.y + 16 + L0*scale - 60;
    massGroup.setAttribute('transform', `translate(${massX},${massY})`);
    // dotted line below mass
    const dotX = springTop.x;
    const dotY = massY + 120;
    dotted.setAttribute('transform', `translate(${dotX},${dotY})`);
    // update attach point for snapping
    const attachY = massY + 60;
    attachPoint.setAttribute('cx', springTop.x);
    attachPoint.setAttribute('cy', attachY);
  }

  function computeTargetExt(m,k){
    const x = (m * g * pxFactor) / k; // tuned
    return Math.min(240, Math.max(8, x));
  }

  function animateTo(targetExt, duration=1000){
    lockUI(true);
    const startExt = currentExt;
    const start = performance.now();
    const tau = 650; // damping
    const freq = 8;  // oscillations
    function frame(t){
      const elapsed = t - start;
      const p = Math.min(1, elapsed/duration);
      const damp = Math.exp(-elapsed/tau);
      const oscill = Math.cos((Math.PI*2*freq) * (elapsed/1000));
      const ext = targetExt + (startExt - targetExt) * damp * oscill;
      setSystem(ext);
      if(elapsed < duration){
        requestAnimationFrame(frame);
      }else{
        setSystem(targetExt);
        lockUI(false);
      }
    }
    requestAnimationFrame(frame);
  }

  function refresh(){
    const target = computeTargetExt(currentMass, springK);
    animateTo(target, 1200);
  }

  // Slider interactions
  let sliding=false;
  function kFromY(y){
    const t = 1 - (y - trackTop)/trackHeight;
    let k = kMin + t*(kMax - kMin);
    // snap to step
    k = Math.round(k/kStep)*kStep;
    return Math.max(kMin, Math.min(kMax, k));
  }
  function onSliderPointer(e){
    const pt = getSVGPoint(e);
    const y = Math.max(trackTop, Math.min(trackTop+trackHeight, pt.y));
    springK = kFromY(y);
    setKnobFromK(springK);
    refresh();
  }
  document.getElementById('slider').addEventListener('pointerdown', e=>{
    sliding=true;
    svg.setPointerCapture(e.pointerId);
    onSliderPointer(e);
  });
  svg.addEventListener('pointermove', e=>{
    if(sliding) onSliderPointer(e);
    if(dragging) onDragMove(e);
  });
  svg.addEventListener('pointerup', e=>{
    if(sliding){
      sliding=false;
      svg.releasePointerCapture(e.pointerId);
    }
    if(dragging) onDragEnd(e);
  });

  // Reset
  resetBtn.addEventListener('click', ()=>{
    springK = 120;
    currentMass = 1;
    setKnobFromK(springK);
    refresh();
    flashReset();
  });

  function flashReset(){
    const btn = resetBtn.querySelector('rect');
    const orig = btn.getAttribute('fill');
    btn.setAttribute('fill', '#9ad0f4');
    setTimeout(()=>btn.setAttribute('fill', orig),150);
  }

  // Draggable mass options
  let dragging=null, ghost=null, dragStart={x:0,y:0};
  options.forEach(g=>{
    g.addEventListener('pointerdown', e=>{
      if(animLocked) return;
      dragging = g;
      dragStart = getSVGPoint(e);
      ghost = g.cloneNode(true);
      ghost.setAttribute('opacity','1');
      ghost.classList.add('draggable');
      svg.appendChild(ghost);
      ghost.style.pointerEvents='none';
      onDragMove(e);
    });
  });

  function onDragMove(e){
    const pt = getSVGPoint(e);
    const dx = pt.x - dragStart.x;
    const dy = pt.y - dragStart.y;
    const base = dragging.getCTM();
    const gBBox = dragging.getBBox();
    const x = pt.x - gBBox.width/2;
    const y = pt.y - gBBox.height/2;
    ghost.setAttribute('transform', `translate(${x},${y})`);
  }

  function onDragEnd(e){
    const pt = getSVGPoint(e);
    const ax = parseFloat(attachPoint.getAttribute('cx'));
    const ay = parseFloat(attachPoint.getAttribute('cy'));
    const dist = Math.hypot(pt.x-ax, pt.y-ay);
    const chosen = Number(dragging.getAttribute('data-mass'))||1;
    if(dist<90){
      currentMass = chosen;
      popAttach();
      refresh();
    }
    if(ghost){ svg.removeChild(ghost); ghost=null;}
    dragging=null;
  }

  function popAttach(){
    massGroup.setAttribute('filter','url(#hoverShadow)');
    setTimeout(()=>massGroup.setAttribute('filter','url(#softShadow)'),180);
  }

  function lockUI(lock){
    const pe = lock?'none':'auto';
    document.getElementById('massOptions').style.pointerEvents=pe;
    document.getElementById('slider').style.pointerEvents=pe;
  }
  let animLocked=false;
  function lockUIInternal(lock){
    animLocked=lock;
    lockUI(lock);
  }
  function lockUI(lock){ // override to also dim? keep as simple
    animLocked=lock;
    const pe = lock?'none':'auto';
    document.getElementById('massOptions').style.pointerEvents=pe;
    document.getElementById('slider').style.pointerEvents=pe;
    resetBtn.style.pointerEvents=pe;
  }

  // Utility to convert pointer to SVG coordinates
  function getSVGPoint(evt){
    const pt = svg.createSVGPoint();
    pt.x = evt.clientX;
    pt.y = evt.clientY;
    const screenCTM = svg.getScreenCTM().inverse();
    return pt.matrixTransform(screenCTM);
  }

  // Initialize default state
  setSystem(computeTargetExt(currentMass, springK));
})();
</script>
</body>
</html>