<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Wave Simulation</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
      background-color: #fafafa;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #simulation-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    svg {
      width: 80vw;
      height: 80vh;
    }
    text {
      font-family: sans-serif;
    }
    .disabled {
      pointer-events: none;
      opacity: 0.5;
    }
    .slider-track {
      fill: #eee;
      rx: 10;
    }
    .slider-thumb {
      fill: #ddd;
      cursor: pointer;
    }
    .thumb-active {
      fill: #bbb;
    }
    .simulate-btn {
      cursor: pointer;
      transition: 0.3s;
    }
    .simulate-btn:hover {
      filter: brightness(1.1);
    }
  </style>
</head>
<body>
<div id="simulation-container">
  <svg viewBox="0 0 1000 1000" preserveAspectRatio="xMidYMid meet">
    <defs>
      <linearGradient id="waveGradient" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" stop-color="#fbb6b6" />
        <stop offset="50%" stop-color="#ffe59d" />
        <stop offset="100%" stop-color="#fbb6b6" />
      </linearGradient>
    </defs>

    <!-- Canvas background -->
    <g id="canvas-area">
      <rect x="100" y="100" width="800" height="500" rx="20" fill="#f2f2f2"/>
      <g id="wave-animation" clip-path="url(#clipWave)">
        <path id="wavePath" d="" stroke="url(#waveGradient)" stroke-width="20" fill="none" />
      </g>
    </g>

    <!-- Controls Panel -->
    <g id="controls-panel">
      <rect x="100" y="650" width="800" height="230" rx="20" fill="#ffffff"/>
      
      <!-- Media Selector -->
      <g id="media-selector">
        <rect x="130" y="670" width="180" height="50" rx="10" fill="#f6f6f6" stroke="#ccc"/>
        <text x="150" y="700" font-size="24" fill="#333" id="mediaText">Air ▾</text>
      </g>

      <!-- Particle Density -->
      <g id="density-slider" transform="translate(130,740)">
        <text x="0" y="0" font-size="18" fill="#333">Particle Density</text>
        <rect class="slider-track" x="0" y="10" width="560" height="10"/>
        <circle id="density-thumb" class="slider-thumb" cx="280" cy="15" r="12"/>
        <text id="density-value" x="570" y="20" font-size="18" fill="#333">5</text>
      </g>

      <!-- Elasticity -->
      <g id="elasticity-slider" transform="translate(130,800)">
        <text x="0" y="0" font-size="18" fill="#333">Elasticity</text>
        <rect class="slider-track" x="0" y="10" width="560" height="10"/>
        <circle id="elasticity-thumb" class="slider-thumb" cx="336" cy="15" r="12"/>
        <text id="elasticity-value" x="570" y="20" font-size="18" fill="#333">6</text>
      </g>

      <!-- Simulate Button -->
      <g id="simulate-button" class="simulate-btn" transform="translate(400,870)">
        <rect x="0" y="0" rx="30" ry="30" width="200" height="60" fill="#4285f4"/>
        <text x="100" y="38" font-size="24" fill="#fff" text-anchor="middle">Simulate</text>
      </g>
    </g>
  </svg>
</div>

<script>
  let mediaType = 'air';
  let particleDensity = 5;
  let elasticity = 6;
  let draggingThumb = null;
  const densityThumb = document.getElementById('density-thumb');
  const elasticityThumb = document.getElementById('elasticity-thumb');
  const densityValueText = document.getElementById('density-value');
  const elasticityValueText = document.getElementById('elasticity-value');

  const SLIDER_WIDTH = 560;
  const SLIDER_MIN = 1;
  const SLIDER_MAX = 10;
  const SLIDER_STEP = (SLIDER_WIDTH) / (SLIDER_MAX - SLIDER_MIN);

  function updateThumbValue(thumb, cx) {
    const rawVal = Math.round(cx / SLIDER_STEP) + 1;
    return Math.min(SLIDER_MAX, Math.max(SLIDER_MIN, rawVal));
  }

  function animateWave(speed) {
    const wavePath = document.getElementById("wavePath");
    let t = 0;
    const width = 800;
    const height = 500;
    function drawFrame() {
      let pathData = "";
      for (let x = 0; x <= width; x++) {
        let y = 250 + 40 * Math.sin((x + t) * 0.02 * speed);
        pathData += (x === 0 ? "M" : "L") + (100 + x) + "," + (100 + y) + " ";
      }
      wavePath.setAttribute("d", pathData);
      t += 1;
      if (mediaType !== 'vacuum') {
        requestAnimationFrame(drawFrame);
      }
    }
    drawFrame();
  }

  function simulateWave() {
    const speedOfSound = Math.sqrt(elasticity / particleDensity);
    if (mediaType === 'vacuum') {
      document.getElementById("wavePath").setAttribute("d", "");
    } else {
      animateWave(speedOfSound);
    }
  }

  function moveThumb(evt, thumb, updateCallback) {
    const pt = thumb.ownerSVGElement.createSVGPoint();
    pt.x = evt.clientX;
    pt.y = evt.clientY;
    const svgP = pt.matrixTransform(thumb.ownerSVGElement.getScreenCTM().inverse());
    let cx = Math.max(0, Math.min(SLIDER_WIDTH, svgP.x - 130));
    thumb.setAttribute("cx", cx);
    updateCallback(cx);
  }

  densityThumb.addEventListener("pointerdown", (e) => { draggingThumb = "density"; e.target.classList.add("thumb-active"); e.preventDefault(); });
  elasticityThumb.addEventListener("pointerdown", (e) => { draggingThumb = "elasticity"; e.target.classList.add("thumb-active"); e.preventDefault(); });

  document.addEventListener("pointermove", (e) => {
    if (draggingThumb === "density") {
      moveThumb(e, densityThumb, (cx) => {
        particleDensity = updateThumbValue(densityThumb, cx);
        densityValueText.textContent = particleDensity;
      });
    } else if (draggingThumb === "elasticity") {
      moveThumb(e, elasticityThumb, (cx) => {
        elasticity = updateThumbValue(elasticityThumb, cx);
        elasticityValueText.textContent = elasticity;
      });
    }
  });
  document.addEventListener("pointerup", () => {
    draggingThumb = null;
    densityThumb.classList.remove("thumb-active");
    elasticityThumb.classList.remove("thumb-active");
  });

  document.getElementById("simulate-button").addEventListener("click", () => {
    simulateWave();
  });

  const mediaSelector = document.getElementById('media-selector');
  const mediaText = document.getElementById('mediaText');
  mediaSelector.addEventListener("click", () => {
    const options = ['Air', 'Water', 'Solid', 'Vacuum'];
    const currentIndex = options.indexOf(mediaText.textContent.replace(' ▾', ''));
    const nextIndex = (currentIndex + 1) % options.length;
    mediaType = options[nextIndex].toLowerCase();
    mediaText.textContent = options[nextIndex] + ' ▾';
  });
</script>
</body>
</html>