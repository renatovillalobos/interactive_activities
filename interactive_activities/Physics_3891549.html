<html>
<head>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #f8f6f2;
      width: 100%;
      height: 100%;
    }

    svg {
      width: 100vw;
      height: 100vh;
      display: block;
      font-family: 'Segoe UI', sans-serif;
    }

    .draggable {
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
      transition: filter 0.2s;
    }

    .draggable:hover {
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
      cursor: grab;
    }

    .button {
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
      transition: filter 0.2s;
    }

    .button:hover {
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3)) brightness(1.1);
      cursor: pointer;
    }

    .slider-knob {
      filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.2));
      transition: filter 0.2s;
    }

    .slider-knob:hover {
      filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3)) brightness(1.1);
      cursor: pointer;
    }

    .value-text {
      font-family: 'Segoe UI', sans-serif;
      font-size: 16px;
      font-weight: 500;
      fill: #333;
      text-anchor: middle;
    }

    .spring-path {
      transition: d 0.2s ease;
      stroke-width: 8;
    }

    .canvas-shadow {
      filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.15));
    }

    .mass-block {
      filter: drop-shadow(0 6px 10px rgba(149, 205, 244, 0.6));
    }

    .footer-panel {
      filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
    }

    .info-icon {
      stroke: #95cdf4;
      stroke-width: 6;
      stroke-linecap: round;
      fill: none;
    }

    .stretch-line {
      stroke: #95cdf4;
      stroke-width: 6;
      stroke-linecap: round;
      stroke-dasharray: 0,12;
    }
  </style>
</head>
<body>
<svg viewBox="0 0 900 900" xmlns="http://www.w3.org/2000/svg">

  <g class="canvas-shadow">
    <rect x="100" y="80" width="700" height="540" rx="50" fill="#fdfcfa"/>

    <g id="mass-selector">
      <rect x="130" y="150" width="120" height="300" rx="30" fill="#fefdfb" filter="url(#mass-panel-shadow)"/>
      <g id="mass1" class="draggable">
        <rect x="155" y="180" width="70" height="50" rx="15" fill="#95cdf4" stroke="#cfdde5"/>
      </g>
      <g id="mass2" class="draggable">
        <rect x="155" y="250" width="70" height="50" rx="15" fill="#95cdf4" stroke="#cfdde5"/>
      </g>
      <g id="mass3" class="draggable">
        <rect x="155" y="320" width="70" height="50" rx="15" fill="#95cdf4" stroke="#cfdde5"/>
      </g>
    </g>

    <g id="spring-system">
      <path id="spring" class="spring-path" d="M450 100
        C440 110, 460 120, 450 130
        C440 140, 460 150, 450 160
        C440 170, 460 180, 450 190
        C440 200, 460 210, 450 220
        C440 230, 460 240, 450 250
        C440 260, 460 270, 450 280
        C440 290, 460 300, 450 310
        C440 320, 460 330, 450 340
        C440 350, 460 360, 450 370
        C440 380, 460 390, 450 400" stroke="#11181e" fill="none"/>

      <g id="attachedMass">
        <rect id="mass-body" class="mass-block" x="400" y="400" width="100" height="100" rx="25" fill="#95cdf4" />
      </g>

      <g id="arrowdown">
        <path d="M450 500 a20 20 0 1 1 1 0" stroke="#95cdf4" stroke-width="6" fill="none"/>
      </g>

      <line id="stretchLine" class="stretch-line" x1="450" y1="500" x2="450" y2="520"/>
    </g>

    <g id="slider-control">
      <rect x="720" y="180" width="20" height="250" rx="12" fill="#f6f4f0"/>
      <circle id="slider-knob" class="slider-knob" cx="730" cy="300" r="20" fill="#95cdf4"/>
      <g id="reset-button" class="button">
        <rect x="680" y="460" width="120" height="60" rx="30" fill="#95cdf4"/>
      </g>
    </g>

    <g id="footer-display">
      <g class="footer-panel">
        <rect x="115" y="660" width="180" height="110" rx="40" fill="#ffffff"/>
        <rect x="170" y="680" width="70" height="70" rx="20" fill="#95cdf4"/>
        <text x="205" y="770" class="value-text">Mass: <tspan id="massText">—</tspan></text>
      </g>

      <g class="footer-panel">
        <rect x="360" y="660" width="180" height="110" rx="40" fill="#ffffff"/>
        <path class="info-icon" d="M435 690 L445 710 L435 730 L445 750"/>
        <text x="450" y="770" class="value-text">Spring k: <tspan id="kText">50</tspan></text>
      </g>

      <g class="footer-panel">
        <rect x="605" y="660" width="180" height="110" rx="40" fill="#ffffff"/>
        <circle class="info-icon" cx="695" cy="690" r="3"/>
        <circle class="info-icon" cx="695" cy="710" r="3"/>
        <circle class="info-icon" cx="695" cy="730" r="3"/>
        <text x="695" y="770" class="value-text">Stretch: <tspan id="stretchText">—</tspan></text>
      </g>
    </g>
  </g>

  <defs>
    <filter id="mass-panel-shadow" x="-50%" y="-50%" width="200%" height="200%">
      <feDropShadow dx="0" dy="4" stdDeviation="8" flood-color="rgba(0,0,0,0.2)"/>
    </filter>
  </defs>

</svg>
<script>
  let dragging = null;
  let offsetX, offsetY;
  let springConstant = 50;
  let attachedMass = null;

  const masses = ["mass1", "mass2", "mass3"];
  const spring = document.getElementById("spring");
  const massBody = document.getElementById("mass-body");
  const springGroup = document.getElementById("spring-system");

  const slider = document.getElementById("slider-knob");
  const line = document.getElementById("stretchLine");

  const massText = document.getElementById("massText");
  const kText = document.getElementById("kText");
  const stretchText = document.getElementById("stretchText");

  slider.addEventListener("pointerdown", startSlide);

  function startSlide(e) {
    e.preventDefault();
    document.addEventListener("pointermove", onSlide);
    document.addEventListener("pointerup", stopSlide);
  }

  function onSlide(e) {
    let svg = document.querySelector("svg");
    let pt = svg.createSVGPoint();
    pt.x = e.clientX;
    pt.y = e.clientY;
    let ctm = svg.getScreenCTM().inverse();
    let loc = pt.matrixTransform(ctm);
    let y = Math.max(190, Math.min(410, loc.y));
    let stepY = Math.round((y - 190) / 22) * 22 + 190;
    slider.setAttribute("cy", stepY);
    springConstant = 100 - ((stepY - 190) / 220 * 90);
    kText.textContent = Math.round(springConstant);
    if (attachedMass) simulate();
  }

  function stopSlide() {
    document.removeEventListener("pointermove", onSlide);
    document.removeEventListener("pointerup", stopSlide);
  }

  masses.forEach(id => {
    let el = document.getElementById(id);
    el.addEventListener("pointerdown", startDrag);
  });

  function startDrag(e) {
    dragging = this;
    let rect = this.getBoundingClientRect();
    offsetX = e.clientX - rect.left;
    offsetY = e.clientY - rect.top;
    document.addEventListener("pointermove", onDrag);
    document.addEventListener("pointerup", stopDrag);
  }

  function onDrag(e) {
    if (!dragging) return;
    let svg = document.querySelector("svg");
    let pt = svg.createSVGPoint();
    pt.x = e.clientX;
    pt.y = e.clientY;
    let ctm = svg.getScreenCTM().inverse();
    let loc = pt.matrixTransform(ctm);
    dragging.setAttribute("transform", `translate(${loc.x - offsetX},${loc.y - offsetY})`);
  }

  function stopDrag(e) {
    document.removeEventListener("pointermove", onDrag);
    document.removeEventListener("pointerup", stopDrag);
    if (!dragging) return;
    let bbox = dragging.getBBox();
    if (bbox.x > 380 && bbox.x < 520 && bbox.y > 400 && bbox.y < 520) {
      attachedMass = dragging;
      dragging.setAttribute("transform", "translate(400,400)");
      simulate();
    } else {
      dragging.setAttribute("transform", "");
    }
    dragging = null;
  }

  function simulate() {
    let m = 1 + masses.indexOf(attachedMass.id);
    let k = springConstant;
    let stretch = (m * 30) / (k / 50);
    let stretchY = stretch * 5;

    massBody.setAttribute("y", 400 + stretchY);

    let top = 100;
    let path = `M450 ${top}`;
    let segments = 10;
    let dY = stretchY + 300;
    let step = dY / segments;
    for (let i = 0; i < segments; i++) {
      let cy = top + step * (i + 1);
      path += ` C440 ${cy - step / 2}, 460 ${cy - step / 2}, 450 ${cy}`;
    }
    spring.setAttribute("d", path);

    line.setAttribute("y1", 400 + stretchY + 100);
    line.setAttribute("y2", 400 + stretchY + 120);

    massText.textContent = m;
    stretchText.textContent = Math.round(stretch * 10) / 10;
  }

  const resetBtn = document.getElementById("reset-button");
  resetBtn.addEventListener("click", () => {
    spring.setAttribute("d", `M450 100
      C440 110, 460 120, 450 130
      C440 140, 460 150, 450 160
      C440 170, 460 180, 450 190
      C440 200, 460 210, 450 220
      C440 230, 460 240, 450 250
      C440 260, 460 270, 450 280
      C440 290, 460 300, 450 310
      C440 320, 460 330, 450 340
      C440 350, 460 360, 450 370
      C440 380, 460 390, 450 400`);

    massBody.setAttribute("y", 400);
    line.setAttribute("y1", 500);
    line.setAttribute("y2", 520);

    if (attachedMass) {
      attachedMass.setAttribute("transform", "");
      attachedMass = null;
    }

    slider.setAttribute("cy", 300);
    springConstant = 50;
    kText.textContent = "50";
    stretchText.textContent = "—";
    massText.textContent = "—";
  });
</script>
</body>
</html>