<html>
<head>
<style>
  html,body{height:100%;margin:0;background:#fbf8f4;}
  #stage{width:92vmin;height:92vmin;display:block;margin:0 auto;touch-action:none;}
  .grabbable{cursor:pointer;}
  .no-select{-webkit-user-select:none;user-select:none;}
</style>
</head>
<body>
<svg id="stage" viewBox="0 0 1000 1000" class="no-select">
  <rect x="0" y="0" width="1000" height="1000" fill="#fbf8f4"/>

  <g id="springAndMass">
    <path id="spring" d="M560 130 a90 90 0 0 0 -90 90 v 300" fill="none" stroke="#cfcfcf" stroke-width="28" stroke-linecap="round"/>
    <rect id="massBlock" x="370" y="520" width="260" height="160" rx="40" fill="#1677ff"/>
  </g>

  <g id="arrow" transform="translate(295,590)">
    <path d="M0 0 v 80" stroke="#1f2227" stroke-width="12" stroke-linecap="round" fill="none"/>
    <path d="M-24 56 L0 80 L24 56" fill="#1f2227"/>
  </g>

  <g id="massSlider" class="grabbable" transform="translate(260,720)">
    <rect x="0" y="0" width="480" height="96" rx="48" fill="#3d4349"/>
    <rect x="72" y="44" width="336" height="8" rx="4" fill="#2d3238" opacity="0.7"/>
    <g id="massHandle" transform="translate(96,48)">
      <circle r="34" fill="#d6d5d5"/>
    </g>
  </g>

  <g id="kSlider" class="grabbable" transform="translate(340,840)">
    <rect x="0" y="0" width="480" height="96" rx="48" fill="#3d4349"/>
    <rect x="72" y="44" width="336" height="8" rx="4" fill="#2d3238" opacity="0.7"/>
    <g id="kHandle" transform="translate(384,48)">
      <circle r="34" fill="#d6d5d5"/>
    </g>
  </g>
</svg>

<script>
const g = 9.8;
let mass = 5.5;
let k = 2.75;

const springTopAfterArcY = 220; 
const baseStraightLen = 280;    
const pxPerMeter = 6.2;

const spring = document.getElementById('spring');
const massRect = document.getElementById('massBlock');

function setSpringLength(len){
  const d = `M560 130 a90 90 0 0 0 -90 90 v ${len}`;
  spring.setAttribute('d', d);
}
let currentY = 520;
let targetY = 520;

function updateTargets(){
  const displacementMeters = (mass * g) / k;
  const stretch = Math.max(0, displacementMeters * pxPerMeter);
  const len = baseStraightLen + stretch;
  const massTop = springTopAfterArcY + len - 10;
  targetY = Math.min(760, Math.max(460, massTop));
}
function animate(){
  currentY += (targetY - currentY) * 0.12;
  setSpringLength(Math.max(120, currentY + 10 - springTopAfterArcY));
  massRect.setAttribute('y', currentY);
  requestAnimationFrame(animate);
}
updateTargets();
animate();

/* Slider helpers */
function makeSlider(groupId, handleId, min, max, initial, onChange){
  const group = document.getElementById(groupId);
  const handle = document.getElementById(handleId);
  const bounds = {x:0,y:0,w:480,h:96,innerL:48,innerR:480-48}; // travel inside pill
  let value = initial;
  let dragging = false;
  function valueToX(v){
    const t = (v - min) / (max - min);
    return bounds.innerL + t * (bounds.innerR - bounds.innerL);
  }
  function xToValue(x){
    const t = (x - bounds.innerL) / (bounds.innerR - bounds.innerL);
    return min + Math.min(1, Math.max(0, t)) * (max - min);
  }
  function setHandlePositionFromValue(v){
    const x = valueToX(v);
    handle.setAttribute('transform', `translate(${x},48)`);
  }
  setHandlePositionFromValue(value);

  function localX(evt){
    const r = group.getBoundingClientRect();
    return (evt.clientX - r.left) * (1000 / document.getElementById('stage').clientWidth) - group.transform.baseVal.consolidate().matrix.e;
  }

  function bounce(){
    const tr = handle.getAttribute('transform');
    handle.setAttribute('transform', tr + ' scale(1.1)');
    setTimeout(()=>handle.setAttribute('transform', tr),120);
  }

  function pointerDown(e){
    dragging = true;
    group.setPointerCapture(e.pointerId);
    const x = Math.min(bounds.innerR, Math.max(bounds.innerL, localX(e)));
    value = xToValue(x);
    setHandlePositionFromValue(value);
    onChange(value);
    bounce();
  }
  function pointerMove(e){
    if(!dragging) return;
    const x = Math.min(bounds.innerR, Math.max(bounds.innerL, localX(e)));
    value = xToValue(x);
    setHandlePositionFromValue(value);
    onChange(value);
  }
  function pointerUp(e){
    dragging = false;
    group.releasePointerCapture(e.pointerId);
  }
  group.addEventListener('pointerdown', pointerDown);
  group.addEventListener('pointermove', pointerMove);
  group.addEventListener('pointerup', pointerUp);
  return {set:v=>{value=v; setHandlePositionFromValue(v); onChange(v);}};
}

const massSlider = makeSlider('massSlider','massHandle',1,10,5.5,v=>{
  mass = v;
  updateTargets();
});
const kSlider = makeSlider('kSlider','kHandle',0.5,5,2.75,v=>{
  k = v;
  updateTargets();
});

/* Initialize positions to mid-range look */
updateTargets();
</script>
</body>
</html>