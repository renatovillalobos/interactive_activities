<html>
<head>
<style>
html, body {
  margin: 0;
  padding: 0;
  background: #f0f0f0;
  height: 100%;
}
body {
  display: flex;
  align-items: center;
  justify-content: center;
}
svg {
  width: 90vmin;
  height: 90vmin;
}
text {
  font-family: Arial, sans-serif;
}
</style>
</head>
<body>
<svg viewBox="0 0 800 800">
  <rect x="0" y="0" width="800" height="800" fill="#f7f9fc"/>

  <rect x="60" y="60" width="680" height="680" rx="26" ry="26" fill="#ffffff" stroke="#d3d9e6" stroke-width="2"/>

  <text x="90" y="120" font-size="28" fill="#1f2933" font-weight="bold">Gear Tooth Experiment</text>
  <text x="90" y="155" font-size="16" fill="#4b5563">Explore how the number of teeth changes gear rotation speed.</text>

  <rect x="90" y="190" width="620" height="2" fill="#e5e7eb"/>

  <rect x="90" y="215" width="300" height="260" rx="16" ry="16" fill="#f3f4f6" stroke="#d1d5db" stroke-width="1.5"/>
  <text x="110" y="245" font-size="18" fill="#111827" font-weight="bold">Materials</text>
  <circle cx="120" cy="275" r="4" fill="#4b5563"/>
  <text x="135" y="280" font-size="14" fill="#4b5563">Paper gears with different numbers of teeth</text>
  <circle cx="120" cy="305" r="4" fill="#4b5563"/>
  <text x="135" y="310" font-size="14" fill="#4b5563">Digital workspace (this simulation)</text>

  <rect x="410" y="215" width="300" height="260" rx="16" ry="16" fill="#f9fafb" stroke="#d1d5db" stroke-width="1.5"/>
  <text x="430" y="245" font-size="18" fill="#111827" font-weight="bold">Procedure</text>
  <text x="430" y="272" font-size="13" fill="#4b5563">1. Drag two gears into the center area.</text>
  <text x="430" y="294" font-size="13" fill="#4b5563">2. Click a gear to start/stop rotation.</text>
  <text x="430" y="316" font-size="13" fill="#4b5563">3. Compare rotation speeds based on</text>
  <text x="430" y="336" font-size="13" fill="#4b5563">   the number of teeth.</text>

  <rect x="90" y="495" width="620" height="215" rx="18" ry="18" fill="#eef2ff" stroke="#c7d2fe" stroke-width="1.5"/>

  <rect x="120" y="520" width="310" height="175" rx="12" ry="12" fill="#ffffff" stroke="#d1d5db" stroke-width="1.5"/>
  <text x="140" y="550" font-size="16" fill="#111827" font-weight="bold">Experiment Zone</text>
  <rect x="140" y="565" width="270" height="1.5" fill="#e5e7eb"/>

  <circle cx="210" cy="640" r="4" fill="#9ca3af"/>
  <circle cx="300" cy="640" r="4" fill="#9ca3af"/>

  <circle id="centerLeft" cx="210" cy="640" r="54" fill="none" stroke="#e5e7eb" stroke-dasharray="4,4" stroke-width="2"/>
  <circle id="centerRight" cx="300" cy="640" r="54" fill="none" stroke="#e5e7eb" stroke-dasharray="4,4" stroke-width="2"/>

  <text x="210" y="635" font-size="10" text-anchor="middle" fill="#9ca3af">Drop</text>
  <text x="210" y="648" font-size="10" text-anchor="middle" fill="#9ca3af">gear</text>
  <text x="300" y="635" font-size="10" text-anchor="middle" fill="#9ca3af">Drop</text>
  <text x="300" y="648" font-size="10" text-anchor="middle" fill="#9ca3af">gear</text>

  <rect x="455" y="520" width="225" height="175" rx="12" ry="12" fill="#ffffff" stroke="#d1d5db" stroke-width="1.5"/>
  <text x="475" y="550" font-size="16" fill="#111827" font-weight="bold">Gear Data</text>
  <rect x="475" y="565" width="185" height="1.5" fill="#e5e7eb"/>

  <text x="475" y="592" font-size="13" fill="#4b5563">Left gear teeth:</text>
  <text id="leftTeethText" x="620" y="592" font-size="13" fill="#111827" text-anchor="end">–</text>

  <text x="475" y="618" font-size="13" fill="#4b5563">Right gear teeth:</text>
  <text id="rightTeethText" x="620" y="618" font-size="13" fill="#111827" text-anchor="end">–</text>

  <text x="475" y="648" font-size="13" fill="#4b5563">Speed ratio (L:R):</text>
  <text id="ratioText" x="620" y="648" font-size="13" fill="#111827" text-anchor="end">–</text>

  <rect id="toggleButton" x="475" y="666" width="185" height="32" rx="8" ry="8" fill="#4f46e5"/>
  <text id="toggleLabel" x="567.5" y="688" font-size="14" fill="#ffffff" text-anchor="middle">Start rotation</text>

  <g id="gearPalette">
    <rect x="90" y="215" width="300" height="260" fill="none"/>
  </g>

  <g id="gear10" data-teeth="10" transform="translate(165,330)">
    <circle cx="0" cy="0" r="35" fill="#e5f3ff" stroke="#3b82f6" stroke-width="2"/>
    <g fill="#3b82f6">
      <rect x="-3" y="-46" width="6" height="12"/>
      <rect x="-3" y="34" width="6" height="12"/>
      <rect x="-46" y="-3" width="12" height="6"/>
      <rect x="34" y="-3" width="12" height="6"/>
      <rect x="-2" y="-46" width="4" height="12" transform="rotate(36)"/>
      <rect x="-2" y="-46" width="4" height="12" transform="rotate(72)"/>
      <rect x="-2" y="-46" width="4" height="12" transform="rotate(108)"/>
      <rect x="-2" y="-46" width="4" height="12" transform="rotate(144)"/>
      <rect x="-2" y="-46" width="4" height="12" transform="rotate(180)"/>
    </g>
    <circle cx="0" cy="0" r="6" fill="#ffffff" stroke="#3b82f6" stroke-width="1.5"/>
    <text x="0" y="55" font-size="12" text-anchor="middle" fill="#111827">10 teeth</text>
  </g>

  <g id="gear20" data-teeth="20" transform="translate(285,330)">
    <circle cx="0" cy="0" r="45" fill="#ecfdf5" stroke="#10b981" stroke-width="2"/>
    <g fill="#10b981">
      <rect x="-3" y="-60" width="6" height="14"/>
      <rect x="-3" y="46" width="6" height="14"/>
      <rect x="-60" y="-3" width="14" height="6"/>
      <rect x="46" y="-3" width="14" height="6"/>
      <rect x="-2" y="-60" width="4" height="14" transform="rotate(18)"/>
      <rect x="-2" y="-60" width="4" height="14" transform="rotate(36)"/>
      <rect x="-2" y="-60" width="4" height="14" transform="rotate(54)"/>
      <rect x="-2" y="-60" width="4" height="14" transform="rotate(72)"/>
      <rect x="-2" y="-60" width="4" height="14" transform="rotate(90)"/>
      <rect x="-2" y="-60" width="4" height="14" transform="rotate(108)"/>
      <rect x="-2" y="-60" width="4" height="14" transform="rotate(126)"/>
      <rect x="-2" y="-60" width="4" height="14" transform="rotate(144)"/>
      <rect x="-2" y="-60" width="4" height="14" transform="rotate(162)"/>
      <rect x="-2" y="-60" width="4" height="14" transform="rotate(180)"/>
    </g>
    <circle cx="0" cy="0" r="7" fill="#ffffff" stroke="#10b981" stroke-width="1.5"/>
    <text x="0" y="65" font-size="12" text-anchor="middle" fill="#111827">20 teeth</text>
  </g>

  <g id="gear30" data-teeth="30" transform="translate(225,260)">
    <circle cx="0" cy="0" r="55" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
    <g fill="#f59e0b">
      <rect x="-3" y="-72" width="6" height="16"/>
      <rect x="-3" y="56" width="6" height="16"/>
      <rect x="-72" y="-3" width="16" height="6"/>
      <rect x="56" y="-3" width="16" height="6"/>
      <rect x="-2" y="-72" width="4" height="16" transform="rotate(12)"/>
      <rect x="-2" y="-72" width="4" height="16" transform="rotate(24)"/>
      <rect x="-2" y="-72" width="4" height="16" transform="rotate(36)"/>
      <rect x="-2" y="-72" width="4" height="16" transform="rotate(48)"/>
      <rect x="-2" y="-72" width="4" height="16" transform="rotate(60)"/>
      <rect x="-2" y="-72" width="4" height="16" transform="rotate(72)"/>
      <rect x="-2" y="-72" width="4" height="16" transform="rotate(84)"/>
      <rect x="-2" y="-72" width="4" height="16" transform="rotate(96)"/>
      <rect x="-2" y="-72" width="4" height="16" transform="rotate(108)"/>
      <rect x="-2" y="-72" width="4" height="16" transform="rotate(120)"/>
      <rect x="-2" y="-72" width="4" height="16" transform="rotate(132)"/>
      <rect x="-2" y="-72" width="4" height="16" transform="rotate(144)"/>
      <rect x="-2" y="-72" width="4" height="16" transform="rotate(156)"/>
      <rect x="-2" y="-72" width="4" height="16" transform="rotate(168)"/>
      <rect x="-2" y="-72" width="4" height="16" transform="rotate(180)"/>
    </g>
    <circle cx="0" cy="0" r="8" fill="#ffffff" stroke="#f59e0b" stroke-width="1.5"/>
    <text x="0" y="78" font-size="12" text-anchor="middle" fill="#111827">30 teeth</text>
  </g>

<script>
const svg = document.querySelector('svg');
const gears = ['gear10','gear20','gear30'].map(id=>document.getElementById(id));
const centerLeft = document.getElementById('centerLeft');
const centerRight = document.getElementById('centerRight');
const leftTeethText = document.getElementById('leftTeethText');
const rightTeethText = document.getElementById('rightTeethText');
const ratioText = document.getElementById('ratioText');
const toggleButton = document.getElementById('toggleButton');
const toggleLabel = document.getElementById('toggleLabel');

let dragging = null;
let offset = {x:0,y:0};
let leftGear = null;
let rightGear = null;
let animating = false;
let lastTime = null;
let angleMap = new Map();

function getEventPoint(evt){
  const pt = svg.createSVGPoint();
  if (evt.touches && evt.touches.length>0){
    pt.x = evt.touches[0].clientX;
    pt.y = evt.touches[0].clientY;
  } else {
    pt.x = evt.clientX;
    pt.y = evt.clientY;
  }
  const m = svg.getScreenCTM().inverse();
  return pt.matrixTransform(m);
}

function startDrag(evt,gear){
  evt.preventDefault();
  const p = getEventPoint(evt);
  const m = gear.transform.baseVal.consolidate();
  const [tx,ty] = m? [m.matrix.e,m.matrix.f] : [0,0];
  offset.x = p.x - tx;
  offset.y = p.y - ty;
  dragging = gear;
  dragging.style.cursor = 'grabbing';
  dragging.style.transition = '';
  dragging.style.opacity = 0.9;
}

function dragMove(evt){
  if(!dragging) return;
  evt.preventDefault();
  const p = getEventPoint(evt);
  const x = p.x - offset.x;
  const y = p.y - offset.y;
  dragging.setAttribute('transform',`translate(${x},${y}) rotate(${angleMap.get(dragging.id)||0})`);
}

function distance(x1,y1,x2,y2){
  const dx=x1-x2,dy=y1-y2;
  return Math.sqrt(dx*dx+dy*dy);
}

function snapGear(gear){
  const m = gear.transform.baseVal.consolidate();
  const baseAngle = angleMap.get(gear.id)||0;
  const gx = m.matrix.e;
  const gy = m.matrix.f;

  const leftBox = centerLeft.getBBox();
  const rightBox = centerRight.getBBox();
  const leftCx = leftBox.x+leftBox.width/2;
  const leftCy = leftBox.y+leftBox.height/2;
  const rightCx = rightBox.x+rightBox.width/2;
  const rightCy = rightBox.y+rightBox.height/2;

  const toLeft = distance(gx,gy,leftCx,leftCy);
  const toRight = distance(gx,gy,rightCx,rightCy);

  const minDist = Math.min(toLeft,toRight);
  if(minDist>70){
    if(gear===leftGear) leftGear=null;
    if(gear===rightGear) rightGear=null;
    updateData();
    return;
  }

  if(toLeft<toRight){
    if(leftGear && leftGear!==gear){
      leftGear = null;
    }
    leftGear = gear;
    gear.setAttribute('transform',`translate(${leftCx},${leftCy}) rotate(${baseAngle})`);
  } else {
    if(rightGear && rightGear!==gear){
      rightGear = null;
    }
    rightGear = gear;
    gear.setAttribute('transform',`translate(${rightCx},${rightCy}) rotate(${baseAngle})`);
  }
  updateData();
}

function endDrag(){
  if(!dragging) return;
  dragSnapTransition(dragging);
  dragging.style.cursor = 'grab';
  dragging.style.opacity = 1;
  dragging = null;
}

function dragSnapTransition(gear){
  snapGear(gear);
}

function getTeeth(gear){
  if(!gear) return null;
  return parseInt(gear.getAttribute('data-teeth'),10);
}

function updateData(){
  const lt = getTeeth(leftGear);
  const rt = getTeeth(rightGear);
  leftTeethText.textContent = lt? lt:'–';
  rightTeethText.textContent = rt? rt:'–';
  if(lt && rt){
    ratioText.textContent = lt+':'+rt;
  } else {
    ratioText.textContent = '–';
  }
}

gears.forEach(g=>{
  angleMap.set(g.id,0);
  g.style.cursor='grab';
  g.addEventListener('mousedown',e=>startDrag(e,g));
  g.addEventListener('touchstart',e=>startDrag(e,g),{passive:false});
});

svg.addEventListener('mousemove',dragMove);
svg.addEventListener('touchmove',dragMove,{passive:false});
svg.addEventListener('mouseup',endDrag);
svg.addEventListener('mouseleave',endDrag);
svg.addEventListener('touchend',endDrag);

toggleButton.addEventListener('click',()=>{
  animating = !animating;
  toggleButton.setAttribute('fill',animating?'#4338ca':'#4f46e5');
  toggleLabel.textContent = animating?'Stop rotation':'Start rotation';
  if(animating){
    lastTime = null;
    requestAnimationFrame(step);
  }
});

function step(timestamp){
  if(!animating) return;
  if(!lastTime) lastTime = timestamp;
  const dt = (timestamp-lastTime)/1000;
  lastTime = timestamp;

  const lt = getTeeth(leftGear)||0;
  const rt = getTeeth(rightGear)||0;

  const baseSpeed = 40;

  if(leftGear){
    let a = angleMap.get(leftGear.id)||0;
    a += baseSpeed*dt;
    angleMap.set(leftGear.id,a);
  }
  if(rightGear && lt && rt){
    let a = angleMap.get(rightGear.id)||0;
    const dir = -1;
    const speed = baseSpeed*lt/rt;
    a += dir*speed*dt;
    angleMap.set(rightGear.id,a);
  } else if(rightGear){
    let a = angleMap.get(rightGear.id)||0;
    a += baseSpeed*dt;
    angleMap.set(rightGear.id,a);
  }

  [leftGear,rightGear].forEach(g=>{
    if(!g) return;
    const m = g.transform.baseVal.consolidate();
    const x = m? m.matrix.e:0;
    const y = m? m.matrix.f:0;
    const ang = angleMap.get(g.id)||0;
    g.setAttribute('transform',`translate(${x},${y}) rotate(${ang})`);
  });

  requestAnimationFrame(step);
}
</script>
</svg>
</body>
</html>