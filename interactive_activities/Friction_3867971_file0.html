<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Friction Speedway</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #fefbf3;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    svg {
      width: 100%;
      height: 100%;
      display: block;
    }
    .draggable {
      cursor: grab;
      transition: transform 0.2s;
    }
    .draggable:active {
      cursor: grabbing;
    }
    .highlight {
      stroke: #0099ff;
      stroke-width: 3;
      stroke-dasharray: 6 3;
      animation: pulse 1s infinite;
    }
    @keyframes pulse {
      0% { stroke-opacity: 1; }
      50% { stroke-opacity: 0.3; }
      100% { stroke-opacity: 1; }
    }
    .hidden {
      opacity: 0;
      pointer-events: none;
    }
    .locked {
      pointer-events: none;
    }
  </style>
</head>
<body>
  <svg viewBox="0 0 1152 768" xmlns="http://www.w3.org/2000/svg" id="app">
    <defs>
      <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
        <feDropShadow dx="0" dy="2" stdDeviation="2" flood-color="#000" flood-opacity="0.25"/>
      </filter>
    </defs>

    <!-- Sky Background -->
    <rect x="0" y="0" width="1152" height="350" fill="#83C4F2"/>

    <!-- Clouds -->
    <g>
      <path d="M280 60a30 30 0 0 1 60 0h20a20 20 0 1 1 0 40h-80a20 20 0 1 1 0-40z" fill="#fff"/>
      <path d="M820 60a30 30 0 0 1 60 0h20a20 20 0 1 1 0 40h-80a20 20 0 1 1 0-40z" fill="#fff"/>
    </g>

    <!-- Road -->
    <rect x="0" y="300" width="1152" height="50" fill="#FBB03B"/>
    <rect x="0" y="330" width="1152" height="40" fill="#2B2A35"/>

    <!-- Track shadow -->
    <rect x="0" y="370" width="1152" height="10" fill="#FDB043"/>

    <!-- Finish Flag -->
    <g id="finish-flag" transform="translate(900, 270)">
      <rect x="0" y="0" width="80" height="80" fill="none"/>
      <path d="M0 0h20v20H0zM20 20h20v20H20zM40 0h20v20H40zM60 20h20v20H60zM0 40h20v20H0zM20 60h20v20H20zM40 40h20v20H40zM60 60h20v20H60z" fill="#fff"/>
      <path d="M20 0h20v20H20zM0 20h20v20H0zM60 0h20v20H60zM40 20h20v20H40zM20 40h20v20H20zM0 60h20v20H0zM60 40h20v20H60zM40 60h20v20H40z" fill="#2B2A35"/>
    </g>

    <!-- Car Shadow -->
    <ellipse cx="576" cy="368" rx="70" ry="10" fill="#1C1C24" opacity="0.3"/>

    <!-- Red Car (Main Track) -->
    <g id="trackCar">
      <g transform="translate(506, 300)">
        <path d="M20 40c0-30 30-60 70-60s70 30 70 60v30h-140z" fill="#EA4422" filter="url(#shadow)"/>
        <rect x="20" y="50" width="140" height="20" fill="#EA4422"/>
        <circle cx="45" cy="70" r="20" fill="#263746"/>
        <circle cx="145" cy="70" r="20" fill="#263746"/>
        <circle cx="45" cy="70" r="10" fill="#FBB03B"/>
        <circle cx="145" cy="70" r="10" fill="#FBB03B"/>
        <rect x="40" y="15" width="25" height="30" rx="5" fill="#1C1C24"/>
        <rect x="75" y="10" width="35" height="35" rx="5" fill="#1C1C24"/>
      </g>
    </g>

    <!-- Left Indicator Hand -->
    <g id="pointer" transform="translate(30,180)">
      <path d="M40 80Q10 70 10 50t30-30Q30 10 40 10t10 20h20q10 0 10 10t-10 10H50v10h20q10 0 10 10t-10 10H50v10h20q10 0 10 10t-10 10H50v10h10q10 0 10 10t-10 10H50q-10 0-10-10z" fill="#fff" stroke="#263746" stroke-width="5"/>
    </g>

    <!-- Traffic Light -->
    <g id="traffic-light" transform="translate(1040, 60)">
      <rect width="100" height="250" rx="40" fill="#3B5C8B"/>
      <circle cx="50" cy="50" r="25" fill="#2B2A35"/>
      <path d="M50 40l20 10-20 10z" fill="#FFA042"/>
      <circle cx="50" cy="150" r="40" fill="#1C2952"/>
      <circle cx="50" cy="150" r="20" fill="#397CEE"/>
    </g>

    <!-- Stopwatch -->
    <g id="stopwatch" transform="translate(880, 400)">
      <rect x="0" y="0" width="200" height="100" rx="30" fill="#192439"/>
      <text x="100" y="65" font-family="Arial, sans-serif" font-size="48" fill="#fff" text-anchor="middle" id="clock">00:00</text>
    </g>

    <!-- Surface Options -->
    <g id="surfaces" transform="translate(160, 440)">
      <g id="surface-sand" class="draggable" data-type="surface" transform="translate(0,0)">
        <rect width="150" height="150" rx="20" fill="#F3C26C"/>
        <circle cx="40" cy="40" r="5" fill="#DCA65C"/>
        <circle cx="90" cy="70" r="4" fill="#DCA65C"/>
        <circle cx="70" cy="110" r="6" fill="#DCA65C"/>
        <circle cx="120" cy="50" r="4" fill="#DCA65C"/>
        <circle cx="50" cy="90" r="4" fill="#DCA65C"/>
      </g>
      <g id="surface-cardboard" class="draggable" data-type="surface" transform="translate(200,0)">
        <rect width="150" height="150" rx="20" fill="#DAB375"/>
        <path d="M20 0v150M40 0v150M60 0v150M80 0v150M100 0v150M120 0v150" stroke="#c99c5f" stroke-width="6"/>
      </g>
      <g id="surface-foil" class="draggable" data-type="surface" transform="translate(400,0)">
        <rect width="150" height="150" rx="20" fill="#D2D1CD"/>
        <path d="M0 40 C50 30 100 40 150 20" stroke="#bbb" stroke-width="3" fill="none"/>
        <path d="M0 100 C50 110 100 90 150 110" stroke="#bbb" stroke-width="3" fill="none"/>
      </g>
    </g>

    <!-- Car Options -->
    <g id="cars" transform="translate(50, 620)">
      <g id="car-blue" class="draggable" data-type="car" transform="translate(0,0)">
        <rect x="10" y="20" width="120" height="30" fill="#1A2D4A" rx="10"/>
        <circle cx="30" cy="60" r="20" fill="#263746"/>
        <circle cx="110" cy="60" r="20" fill="#263746"/>
        <circle cx="30" cy="60" r="10" fill="#FBB03B"/>
        <circle cx="110" cy="60" r="10" fill="#FBB03B"/>
      </g>
      <g id="car-yellow" class="draggable" data-type="car" transform="translate(180,0)">
        <rect x="10" y="20" width="120" height="30" fill="#F8B429" rx="10"/>
        <circle cx="30" cy="60" r="20" fill="#263746"/>
        <circle cx="110" cy="60" r="20" fill="#263746"/>
        <circle cx="30" cy="60" r="10" fill="#F9471E"/>
        <circle cx="110" cy="60" r="10" fill="#F9471E"/>
      </g>
      <g id="car-green" class="draggable" data-type="car" transform="translate(360,0)">
        <rect x="10" y="20" width="120" height="30" fill="#3F9248" rx="10"/>
        <circle cx="30" cy="60" r="20" fill="#263746"/>
        <circle cx="110" cy="60" r="20" fill="#263746"/>
        <circle cx="30" cy="60" r="10" fill="#5CD35C"/>
        <circle cx="110" cy="60" r="10" fill="#5CD35C"/>
      </g>
      <g id="car-red" class="draggable" data-type="car" transform="translate(540,0)">
        <rect x="10" y="20" width="120" height="30" fill="#EA4422" rx="10"/>
        <circle cx="30" cy="60" r="20" fill="#263746"/>
        <circle cx="110" cy="60" r="20" fill="#263746"/>
        <circle cx="30" cy="60" r="10" fill="#FBB03B"/>
        <circle cx="110" cy="60" r="10" fill="#FBB03B"/>
      </g>
    </g>

    <!-- Start Button -->
    <g id="start" transform="translate(950, 640)" cursor="pointer">
      <circle r="80" cx="80" cy="80" fill="#397CEE"/>
      <circle r="40" cx="80" cy="80" fill="#FEFEFE"/>
    </g>

    <!-- Surface Drop Zone on track -->
    <g id="drop-surface-zone">
      <rect x="100" y="330" width="800" height="40" fill="transparent" stroke="#ccc" stroke-dasharray="10 5"/>
    </g>

    <!-- Car Drop Zone -->
    <g id="drop-car-zone">
      <rect x="100" y="280" width="100" height="60" fill="transparent" stroke="#ccc" stroke-dasharray="10 5"/>
    </g>
  </svg>

  <script>
    const svg = document.querySelector('svg');
    let selected = null;
    let offset = {x:0, y:0};
    let original = {x:0, y:0};
    const dropZones = {
      surface: document.getElementById("drop-surface-zone").children[0].getBBox(),
      car: document.getElementById("drop-car-zone").children[0].getBBox()
    };
    svg.querySelectorAll('.draggable').forEach(el => {
      el.addEventListener('pointerdown', e => {
        selected = el;
        selected.classList.add("dragging");
        const pt = svg.createSVGPoint();
        pt.x = e.clientX;
        pt.y = e.clientY;
        const loc = pt.matrixTransform(svg.getScreenCTM().inverse());
        const transform = selected.transform.baseVal.getItem(0).matrix;
        offset.x = loc.x - transform.e;
        offset.y = loc.y - transform.f;
        original.x = transform.e;
        original.y = transform.f;
        svg.setPointerCapture(e.pointerId);
      });
    });
    svg.addEventListener('pointermove', e => {
      if (!selected) return;
      const pt = svg.createSVGPoint();
      pt.x = e.clientX;
      pt.y = e.clientY;
      const loc = pt.matrixTransform(svg.getScreenCTM().inverse());
      const dx = loc.x - offset.x;
      const dy = loc.y - offset.y;
      selected.setAttribute('transform', `translate(${dx},${dy})`);
    });
    svg.addEventListener('pointerup', e => {
      if (!selected) return;
      const bbox = selected.getBBox();
      const type = selected.dataset.type;
      const dz = dropZones[type];
      if (bbox.x + bbox.width/2 > dz.x && bbox.x + bbox.width/2 < dz.x + dz.width &&
          bbox.y + bbox.height/2 > dz.y && bbox.y + bbox.height/2 < dz.y + dz.height) {
        selected.setAttribute('transform', `translate(${dz.x},${dz.y})`);
        selected.classList.add("locked");
        selected.classList.remove("draggable");
        selected = null;
      } else {
        selected.setAttribute('transform', `translate(${original.x},${original.y})`);
        selected = null;
      }
    });

    // Start button: move car, trigger timer
    document.getElementById('start').addEventListener('click', () => {
      const car = document.getElementById('trackCar');
      const clock = document.getElementById('clock');
      let startTime = null;
      car.setAttribute('transform', 'translate(100,300)');
      clock.textContent = "00:00";
      requestAnimationFrame(function tick(t) {
        if (!startTime) startTime = t;
        const progress = (t - startTime)/3000;
        if (progress < 1) {
          car.setAttribute('transform', `translate(${100 + progress * 700},300)`);
          const seconds = Math.floor(progress * 3);
          const ms = Math.floor((progress * 3000) % 1000);
          clock.textContent = `0${seconds}:${(ms/10).toFixed(0).padStart(2,'0')}`;
          requestAnimationFrame(tick);
        } else {
          car.setAttribute('transform', `translate(800,300)`);
          clock.textContent = "03:00";
        }
      });
    });
  </script>
</body>
</html>