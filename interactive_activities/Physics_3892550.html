<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
html,body{height:100%;margin:0;background:#fbf9f5;font-family:Inter,system-ui,Segoe UI,Arial,sans-serif}
svg{width:100%;height:100%;display:block;touch-action:none}
text{fill:#3b3b3b}
button{display:none}
</style>
</head>
<body>
<svg viewBox="0 0 900 900">
  <defs>
    <filter id="btnShadow" x="-30%" y="-30%" width="160%" height="160%">
      <feDropShadow dx="0" dy="3" stdDeviation="6" flood-color="#000" flood-opacity="0.18"/>
    </filter>
  </defs>

  <rect x="0" y="0" width="900" height="900" fill="#fbf9f5"/>

  <!-- LEFT COLUMN (rod + mass) -->
  <g id="spring1">
    <rect x="135" y="95" width="50" height="50" rx="14" fill="#9e9e9e"/>
    <rect x="155" y="135" width="20" height="420" rx="10" fill="#9e9e9e"/>
    <rect x="125" y="505" width="80" height="45" rx="16" fill="#9e9e9e"/>
    <circle id="mass1" cx="165" cy="645" r="65" fill="#2f86ff" style="cursor:grab"/>
  </g>

  <!-- MIDDLE COLUMN (spring + mass + guide + arrow) -->
  <g id="spring2">
    <rect x="410" y="100" width="50" height="80" rx="12" fill="#9e9e9e"/>
    <path id="springPath2" d="" fill="none" stroke="#9e9e9e" stroke-width="18" stroke-linecap="round" stroke-linejoin="round"/>
    <rect id="guide2" x="446" y="560" width="8" height="220" fill="#f3e3a6" opacity="0.9"/>
    <circle id="mass2" cx="435" cy="525" r="65" fill="#2f86ff" style="cursor:grab"/>
  </g>

  <!-- Yellow downward arrow hint -->
  <g id="hintArrow" opacity="1">
    <path d="M520 360 L520 455" stroke="#f5b402" stroke-width="14" stroke-linecap="round"/>
    <path d="M520 480 L545 450 L495 450 Z" fill="#f5b402"/>
  </g>

  <!-- RIGHT COLUMN (spring + mass) -->
  <g id="spring3">
    <rect x="710" y="100" width="50" height="80" rx="12" fill="#9e9e9e"/>
    <path id="springPath3" d="" fill="none" stroke="#9e9e9e" stroke-width="18" stroke-linecap="round" stroke-linejoin="round"/>
    <circle id="mass3" cx="720" cy="600" r="65" fill="#2f86ff" style="cursor:grab"/>
  </g>

  <!-- RESET BUTTON -->
  <g id="resetBtn" style="cursor:pointer" transform="translate(325,740)">
    <rect x="0" y="0" width="250" height="90" rx="22" fill="#ffffff" filter="url(#btnShadow)"/>
    <g transform="translate(25,22)">
      <path d="M30 17 A28 28 0 1 1 10 37" fill="none" stroke="#2c2c2c" stroke-width="6" stroke-linecap="round"/>
      <path d="M8 12 L32 12 L20 26 Z" fill="#2c2c2c" transform="translate(5,22) rotate(-135 20 12)"/>
    </g>
    <text x="95" y="56" font-size="32" font-weight="600">reset</text>
  </g>
</svg>

<script>
const svg = document.querySelector('svg');

function makeZigZag(x, yTop, yBottom, coils=6, amp=28){
  const total = yBottom - yTop;
  const steps = coils*2;
  const step = total/steps;
  let d = `M ${x} ${yTop}`;
  for(let i=1;i<=steps;i++){
    const y = yTop + i*step;
    const side = i%2===1 ? x+amp : x-amp;
    d += ` L ${side} ${y}`;
  }
  d += ` L ${x} ${yBottom}`;
  return d;
}

const springs = [
  {
    id:1,
    group:document.getElementById('spring1'),
    mass:document.getElementById('mass1'),
    path:null,
    guide:null,
    anchorTop:150,
    restY:645,
    minY:560,
    maxY:770,
    kEffect:0.25,
    w:10,
    damping:3,
    x:165,
    r:65,
    hasSpring:false
  },
  {
    id:2,
    group:document.getElementById('spring2'),
    mass:document.getElementById('mass2'),
    path:document.getElementById('springPath2'),
    guide:document.getElementById('guide2'),
    anchorTop:180,
    restY:525,
    minY:470,
    maxY:750,
    kEffect:0.65,
    w:14,
    damping:3.2,
    x:435,
    r:65,
    hasSpring:true
  },
  {
    id:3,
    group:document.getElementById('spring3'),
    mass:document.getElementById('mass3'),
    path:document.getElementById('springPath3'),
    guide:null,
    anchorTop:180,
    restY:600,
    minY:520,
    maxY:780,
    kEffect:0.55,
    w:12,
    damping:3.0,
    x:720,
    r:65,
    hasSpring:true
  }
];

// initialize paths
function updateAll(){
  springs.forEach(s=>updateVisual(s, s.mass.cy.baseVal.value));
}
function updateVisual(s, cy){
  if(s.hasSpring){
    const bottom = cy - 22;
    s.path.setAttribute('d', makeZigZag(s.x+15, s.anchorTop, bottom, 6, 28));
  }
  if(s.guide){
    const top = cy - 10;
    const h = Math.max(0, 780 - top);
    s.guide.setAttribute('y', top);
    s.guide.setAttribute('height', h);
  }
}
updateAll();

// drag logic with release oscillation
let active = null;

springs.forEach(s=>{
  s.anim = {running:false};
  s.mass.addEventListener('pointerdown', e=>{
    e.preventDefault();
    active = {spring:s, grabY:e.clientY, startCy: s.mass.cy.baseVal.value};
    s.mass.setPointerCapture(e.pointerId);
    s.mass.style.cursor = 'grabbing';
    stopAnim(s);
  });
  s.mass.addEventListener('pointermove', e=>{
    if(!active || active.spring!==s) return;
    const dy = e.clientY - active.grabY;
    let newY = active.startCy + dy;
    newY = Math.max(s.minY, Math.min(s.maxY, newY));
    s.mass.setAttribute('cy', newY);
    updateVisual(s, newY);
  });
  s.mass.addEventListener('pointerup', e=>{
    if(!active || active.spring!==s) return;
    s.mass.releasePointerCapture(e.pointerId);
    s.mass.style.cursor = 'grab';
    const releasedY = s.mass.cy.baseVal.value;
    startOscillation(s, releasedY);
    active = null;
  });
});

function startOscillation(s, releasedY){
  const base = s.restY;
  const eq = base + (releasedY - base) * s.kEffect;
  const A = releasedY - eq;
  s.anim = {
    running:true,
    t0: performance.now(),
    eq, A,
    w: s.w,
    damping: s.damping
  };
  requestAnimationFrame(tick);
}

function stopAnim(s){
  if(s.anim) s.anim.running=false;
}

function tick(now){
  let any=false;
  springs.forEach(s=>{
    if(!s.anim.running) return;
    any=true;
    const t = (now - s.anim.t0)/1000;
    const A = s.anim.A * Math.exp(-s.anim.damping * t);
    const y = s.anim.eq + A * Math.cos(s.anim.w * t);
    s.mass.setAttribute('cy', y);
    updateVisual(s, y);
    if(Math.abs(A) < 0.6){
      s.anim.running = false;
      s.mass.setAttribute('cy', s.anim.eq);
      updateVisual(s, s.anim.eq);
    }
  });
  if(any) requestAnimationFrame(tick);
}

// reset button
document.getElementById('resetBtn').addEventListener('click', ()=>{
  springs.forEach(s=>{
    stopAnim(s);
    s.mass.setAttribute('cy', s.restY);
    updateVisual(s, s.restY);
  });
});

// initial paths
updateAll();
</script>
</body>
</html>