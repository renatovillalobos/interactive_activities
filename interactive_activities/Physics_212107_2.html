<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  html,body{height:100%;margin:0;background:#e9eff3;font-family:Inter,system-ui,Segoe UI,Helvetica,Arial,sans-serif;}
  #container{width:100vmin;height:100vmin;max-width:100%;max-height:100%;margin:auto;display:block;}
  svg{width:100%;height:100%;}
  .grab{cursor:grab;}
  .grabbing{cursor:grabbing;}
  #resetButton:hover{opacity:.9}
  #weightInner{transform-box:fill-box;transform-origin:center;}
</style>
</head>
<body>
<div id="container">
<svg id="svg" viewBox="0 0 1000 1000">
  <rect x="0" y="0" width="1000" height="1000" fill="#e9eff3"/>

  <!-- Planets -->
  <g id="planets">
    <!-- Earth -->
    <g id="planet0" data-index="0" transform="translate(180,160)">
      <circle r="96" fill="#59b7cc"/>
      <g fill="#37b578">
        <path d="M-60-55c22-20 55-26 70-15 8 6 4 20-6 26-9 5-14 14-10 22 6 12-2 23-16 23-28 0-70-29-38-56z"/>
        <path d="M-75 22c9-10 35-5 47 3 10 6 17 18 13 27-6 14-28 18-45 9-16-8-24-25-15-39z"/>
        <path d="M49-14c16-8 31 1 36 12 6 14-6 29-19 36-19 10-37 9-41-5-5-15 11-32 24-43z"/>
      </g>
    </g>
    <!-- Mars -->
    <g id="planet1" data-index="1" transform="translate(500,160)">
      <circle r="92" fill="#c95738"/>
      <g fill="#a64830" opacity="0.9">
        <circle cx="-40" cy="-25" r="18"/>
        <path d="M-10 5c30-28 59-9 50 18-7 24-42 42-63 34-17-6-16-29 13-52z"/>
        <circle cx="54" cy="30" r="10"/>
      </g>
    </g>
    <!-- Jupiter-like -->
    <g id="planet2" data-index="2" transform="translate(820,160)">
      <defs>
        <clipPath id="clipJ">
          <circle r="100"/>
        </clipPath>
      </defs>
      <circle r="100" fill="#e7b36a"/>
      <g clip-path="url(#clipJ)">
        <rect x="-110" y="-80" width="220" height="26" fill="#e0a65b" opacity="0.8"/>
        <rect x="-110" y="-40" width="220" height="28" fill="#efc27e" opacity="0.65"/>
        <rect x="-110" y="0" width="220" height="26" fill="#d89e54" opacity="0.9"/>
        <rect x="-110" y="40" width="220" height="28" fill="#efc27e" opacity="0.65"/>
        <rect x="-110" y="80" width="220" height="26" fill="#d89e54" opacity="0.9"/>
      </g>
    </g>
  </g>

  <!-- Scale beam (rotates) -->
  <g id="beam" transform="rotate(0,500,368)">
    <rect x="110" y="350" width="780" height="40" rx="20" fill="#9ec7c6"/>
    <!-- small connector that moves with beam -->
    <rect x="494" y="390" width="12" height="34" rx="6" fill="#2f3d46"/>
  </g>

  <!-- Support (static) -->
  <g id="support">
    <path d="M500 430 L546 516 L454 516 Z" fill="#2f3d46"/>
  </g>

  <!-- Up arrow -->
  <g id="arrow" transform="translate(500,620)" fill="#2f3d46">
    <rect x="-6" y="22" width="12" height="56" rx="6"/>
    <path d="M0 0 L18 24 L-18 24 Z"/>
  </g>

  <!-- Weight (draggable) -->
  <g id="weight" class="grab" transform="translate(500,780)">
    <g id="weightInner" fill="#2f3d46">
      <rect x="-52" y="-10" width="104" height="88" rx="26"/>
      <rect x="-28" y="-66" width="56" height="36" rx="18"/>
      <rect x="-22" y="-60" width="44" height="20" rx="10" fill="#e9eff3"/>
    </g>
  </g>

  <!-- Reset button -->
  <g id="resetButton" transform="translate(840,860)" style="cursor:pointer">
    <rect x="-120" y="-38" width="160" height="76" rx="28" fill="#d7e1e8"/>
    <text x="-80" y="8" font-size="36" fill="#6f7f88" font-weight="700">RESET</text>
  </g>
</svg>
</div>

<script>
  const svg = document.getElementById('svg');

  const gravityValues = [1.0, 0.38, 2.34];
  const planetXs = [180, 500, 820];
  const planetCY = 160;

  let currentPlanet = null;
  let isDragging = false;
  let locked = false;

  const weight = document.getElementById('weight');
  const weightInner = document.getElementById('weightInner');
  const beam = document.getElementById('beam');
  const resetBtn = document.getElementById('resetButton');

  let weightPos = {x:500,y:780};
  let startOffset = {x:0,y:0};
  let scaleRotation = 0;
  const pivot = {x:500, y:368};

  function setWeight(x,y){
    weightPos.x = x; weightPos.y = y;
    weight.setAttribute('transform',`translate(${x},${y})`);
  }

  function pointFromEvent(evt){
    const pt = svg.createSVGPoint();
    pt.x = evt.clientX; pt.y = evt.clientY;
    return pt.matrixTransform(svg.getScreenCTM().inverse());
  }

  function clamp(n,min,max){ return Math.max(min, Math.min(max,n)); }

  function nearestPlanetIndex(x){
    let ix=0, best=Infinity;
    for(let i=0;i<planetXs.length;i++){
      const d = Math.abs(x-planetXs[i]);
      if(d<best){best=d;ix=i;}
    }
    return ix;
  }

  function highlightPlanet(i){
    for(let k=0;k<3;k++){
      const g = document.getElementById('planet'+k);
      const cx = planetXs[k], cy = planetCY;
      const s = (k===i) ? 1.06 : 1.0;
      g.setAttribute('transform',`translate(${cx},${cy}) scale(${s}) translate(${-cx},${-cy})`);
      g.style.opacity = (k===i)?'1':'0.9';
    }
  }

  function animateWeightBounce(){
    let t=0; const dur=180;
    function step(){
      t+=16;
      const p = t/dur;
      const s = (p<0.5) ? (1-(0.12*p*2)) : (0.88+(0.12*(p-0.5)*2));
      weightInner.style.transform = `scale(${s})`;
      if(t<dur) requestAnimationFrame(step);
      else weightInner.style.transform='scale(1)';
    }
    requestAnimationFrame(step);
  }

  function animateTilt(target){
    locked = true;
    const start = scaleRotation;
    const maxStep = 400;
    let t=0;

    function easeOutCubic(x){return 1-Math.pow(1-x,3);}
    function step(){
      t += 16;
      const p = Math.min(1, t/maxStep);
      const val = start + (target-start)*easeOutCubic(p);
      scaleRotation = val;
      beam.setAttribute('transform',`rotate(${val},${pivot.x},${pivot.y})`);
      if(p<1) requestAnimationFrame(step);
      else setTimeout(()=>{locked=false;},120);
    }
    requestAnimationFrame(step);
  }

  function simulate(){
    const g = gravityValues[currentPlanet];
    const target = Math.max(-18, Math.min(18,(g-1)*18));
    animateWeightBounce();
    animateTilt(target);
  }

  weight.addEventListener('pointerdown', (e)=>{
    if(locked) return;
    isDragging = true;
    weight.classList.add('grabbing');
    weight.setPointerCapture(e.pointerId);
    const pt = pointFromEvent(e);
    startOffset.x = pt.x - weightPos.x;
    startOffset.y = pt.y - weightPos.y;
  });

  svg.addEventListener('pointermove', (e)=>{
    if(!isDragging || locked) return;
    const pt = pointFromEvent(e);
    let nx = pt.x - startOffset.x;
    let ny = pt.y - startOffset.y;
    nx = clamp(nx, 90, 910);
    ny = clamp(ny, 460, 820);
    setWeight(nx, ny);
  });

  svg.addEventListener('pointerup', (e)=>{
    if(!isDragging || locked) return;
    isDragging = false;
    weight.classList.remove('grabbing');

    if(weightPos.y <= 500){ // dropped near the scale
      const idx = nearestPlanetIndex(weightPos.x);
      currentPlanet = idx;
      highlightPlanet(idx);
      // snap horizontally under selected planet, and just below the beam
      setWeight(planetXs[idx], 520);
      simulate();
    } else {
      // snap back if not on scale
      setWeight(500,780);
      highlightPlanet(null);
      animateTilt(0);
    }
  });

  resetBtn.addEventListener('click', ()=>{
    if(locked) { locked=false; }
    currentPlanet = null;
    highlightPlanet(null);
    animateTilt(0);
    setWeight(500,780);
  });

  // Initial placements to match image precisely
  setWeight(500,780);
  highlightPlanet(null);
</script>
</body>
</html>